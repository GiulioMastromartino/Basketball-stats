{% extends "base.html" %}

{% block content %}
<style>
    /* Tooltip styling matching other pages */
    .stat-header {
        position: relative;
        cursor: help;
        display: inline-block;
    }

    .stat-tooltip {
        visibility: hidden;
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: #2d3748;
        color: white;
        padding: 6px 10px;
        border-radius: 6px;
        font-size: 11px;
        white-space: nowrap;
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.2s;
        pointer-events: none;
        margin-bottom: 5px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        font-weight: 400;
        text-transform: none;
    }

    .stat-tooltip::after {
        content: "";
        position: absolute;
        top: 100%;
        left: 50%;
        margin-left: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: #2d3748 transparent transparent transparent;
    }

    .stat-header:hover .stat-tooltip {
        visibility: visible;
        opacity: 1;
    }
</style>

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1>Players Table</h1>
            <p class="text-muted">{{ stats|length }} active players</p>
        </div>
        <div class="d-flex gap-2">
            <a href="{{ url_for('main.players', view='cards', game_type=filters.type) }}" class="btn btn-outline-primary">
                <i class="fas fa-th"></i> Card View
            </a>
            <a href="#" class="btn btn-primary">
                <i class="fas fa-plus"></i> Add Player
            </a>
        </div>
    </div>

    <!-- Controls / Filter Bar -->
    <div class="card mb-4">
        <div class="card-body p-3">
            <div class="d-flex flex-wrap gap-3 align-items-center justify-content-between">
                <!-- Search -->
                <div style="flex: 1; min-width: 250px; position: relative;">
                    <i class="fas fa-search" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted);"></i>
                    <input type="text" placeholder="Search players..." style="padding-left: 36px; width: 100%; border-radius: var(--border-radius);" onkeyup="searchTable(this.value)">
                </div>

                <!-- Filters -->
                <div class="d-flex gap-2">
                    <select class="form-select" style="width: auto;" id="gameTypeFilter" onchange="window.location.href='{{ url_for('main.players', view='table') }}&game_type=' + this.value">
                        <option value="ALL" {% if filters.type == 'ALL' %}selected{% endif %}>All Games</option>
                        <option value="Season" {% if filters.type == 'Season' %}selected{% endif %}>Season</option>
                        <option value="Friendly" {% if filters.type == 'Friendly' %}selected{% endif %}>Friendly</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0" id="playersTable">
                <thead class="table-light">
                    <tr>
                        <th style="min-width: 200px;">Player</th>
                        <th class="text-center">
                            <span class="stat-header">GP<span class="stat-tooltip">Games Played</span></span>
                        </th>
                        <th class="text-center">
                            <span class="stat-header">MPG<span class="stat-tooltip">Minutes Per Game</span></span>
                        </th>
                        <th class="text-center bg-light border-start border-end">
                            <span class="stat-header">PPG<span class="stat-tooltip">Points Per Game</span></span>
                        </th>
                        <th class="text-center">
                            <span class="stat-header">RPG<span class="stat-tooltip">Rebounds Per Game</span></span>
                        </th>
                        <th class="text-center">
                            <span class="stat-header">APG<span class="stat-tooltip">Assists Per Game</span></span>
                        </th>
                        <th class="text-center">
                            <span class="stat-header">SPG<span class="stat-tooltip">Steals Per Game</span></span>
                        </th>
                        <th class="text-center">
                            <span class="stat-header">BPG<span class="stat-tooltip">Blocks Per Game</span></span>
                        </th>
                        <th class="text-center border-start">
                            <span class="stat-header">FG%<span class="stat-tooltip">Field Goal Percentage</span></span>
                        </th>
                        <th class="text-center">
                            <span class="stat-header">3P%<span class="stat-tooltip">3-Point Percentage</span></span>
                        </th>
                        <th class="text-center">
                            <span class="stat-header">FT%<span class="stat-tooltip">Free Throw Percentage</span></span>
                        </th>
                        <th class="text-center border-start">
                            <span class="stat-header">EFF<span class="stat-tooltip">Efficiency Rating</span></span>
                        </th>
                        <th class="text-center">
                            <span class="stat-header">PPP<span class="stat-tooltip">Points Per Possession</span></span>
                        </th>
                         <th class="text-center">
                            <span class="stat-header">ORtg<span class="stat-tooltip">Offensive Rating (Pts/100 Poss)</span></span>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% for p in stats %}
                    <tr>
                        <td>
                            <a href="{{ url_for('main.player_detail', player_name=p.player_name, game_type=filters.type) }}" class="d-flex align-items-center text-decoration-none text-dark fw-bold">
                                <div class="rounded-circle bg-light d-flex align-items-center justify-content-center me-2" style="width: 32px; height: 32px; font-size: 12px; border: 1px solid #dee2e6;">
                                    {{ p.player_name[:2]|upper }}
                                </div>
                                {{ p.player_name }}
                            </a>
                        </td>
                        <td class="text-center">{{ p.games_played }}</td>
                        <td class="text-center">{{ p.mpg|round(1) }}</td>
                        <td class="text-center bg-light border-start border-end fw-bold">{{ p.ppg|round(1) }}</td>
                        <td class="text-center">{{ p.rpg|round(1) }}</td>
                        <td class="text-center">{{ p.apg|round(1) }}</td>
                        <td class="text-center">{{ p.spg|round(1) }}</td>
                        <td class="text-center">{{ p.bpg|round(1) }}</td>
                        <td class="text-center border-start">{{ (p.fg_pct * 100)|round(1) }}%</td>
                        <td class="text-center">{{ (p.tp_pct * 100)|round(1) }}%</td>
                        <td class="text-center">{{ (p.ft_pct * 100)|round(1) }}%</td>
                        <td class="text-center border-start fw-bold">{{ p.eff|round(1) }}</td>
                        <td class="text-center">{{ p.ppp|round(2) }}</td>
                        <td class="text-center">{{ p.ortg|round(0) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    function searchTable(query) {
        const rows = document.querySelectorAll('#playersTable tbody tr');
        const lowerQuery = query.toLowerCase();
        
        rows.forEach(row => {
            const nameCell = row.cells[0].textContent.trim().toLowerCase();
            if (nameCell.includes(lowerQuery)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    }
</script>
{% endblock %}