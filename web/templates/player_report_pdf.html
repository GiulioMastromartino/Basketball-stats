<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{{ player_name }} - Player Report</title>
  <style>
    @page {
      size: A4;
      margin: 1.5cm;
      @bottom-right {
        content: "Page " counter(page) " of " counter(pages);
        font-size: 9px;
        color: #666;
      }
    }
    
    body {
      font-family: 'Helvetica', 'Arial', sans-serif;
      font-size: 10px;
      line-height: 1.4;
      color: #333;
    }
    
    h1 {
      font-size: 24px;
      margin: 0 0 8px 0;
      color: #1a1a1a;
      border-bottom: 3px solid #0066cc;
      padding-bottom: 8px;
    }
    
    h2 {
      font-size: 16px;
      margin: 20px 0 10px 0;
      color: #0066cc;
      border-bottom: 1px solid #ccc;
      padding-bottom: 4px;
      page-break-after: avoid;
    }
    
    h3 {
      font-size: 13px;
      margin: 12px 0 6px 0;
      color: #333;
      font-weight: 600;
    }
    
    .page-break {
      page-break-after: always;
    }
    
    .header-info {
      background: #f5f5f5;
      padding: 10px;
      margin: 10px 0;
      border-left: 4px solid #0066cc;
    }
    
    .header-info p {
      margin: 2px 0;
      font-size: 11px;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
      font-size: 9px;
    }
    
    th, td {
      border: 1px solid #ddd;
      padding: 6px 4px;
      text-align: center;
    }
    
    th {
      background: #0066cc;
      color: white;
      font-weight: 600;
      font-size: 9px;
    }
    
    tr:nth-child(even) {
      background: #f9f9f9;
    }
    
    .highlight {
      background: #fff3cd !important;
      font-weight: bold;
    }
    
    .positive {
      color: #28a745;
      font-weight: bold;
    }
    
    .negative {
      color: #dc3545;
      font-weight: bold;
    }
    
    .section-box {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      padding: 12px;
      margin: 10px 0;
      border-radius: 4px;
    }
    
    .stat-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin: 10px 0;
    }
    
    .stat-card {
      background: white;
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
      border-radius: 4px;
    }
    
    .stat-label {
      font-size: 8px;
      color: #666;
      text-transform: uppercase;
    }
    
    .stat-value {
      font-size: 18px;
      font-weight: bold;
      color: #0066cc;
      margin: 4px 0;
    }
    
    .chart-container {
      margin: 15px 0;
      text-align: center;
      page-break-inside: avoid;
    }
    
    .chart-container img {
      max-width: 100%;
      height: auto;
    }
    
    .note {
      font-size: 8px;
      color: #666;
      font-style: italic;
      margin-top: 4px;
    }
    
    .game-log-table {
      font-size: 8px;
    }
    
    .game-log-table th {
      font-size: 8px;
    }
    
    .win {
      color: #28a745;
      font-weight: bold;
    }
    
    .loss {
      color: #dc3545;
      font-weight: bold;
    }
    
    /* Team Rankings Styles */
    .rank-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-weight: bold;
      font-size: 10px;
      margin-left: 8px;
    }
    
    .rank-1 {
      background: #ffd700;
      color: #000;
    }
    
    .rank-top3 {
      background: #28a745;
      color: white;
    }
    
    .rank-top50 {
      background: #0066cc;
      color: white;
    }
    
    .rank-bottom {
      background: #dc3545;
      color: white;
    }
    
    .percentile-bar {
      width: 100%;
      height: 20px;
      background: #e9ecef;
      border-radius: 10px;
      overflow: hidden;
      position: relative;
      margin: 8px 0;
    }
    
    .percentile-fill {
      height: 100%;
      background: linear-gradient(90deg, #dc3545 0%, #ffc107 50%, #28a745 100%);
      transition: width 0.3s ease;
    }
    
    .percentile-marker {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: 9px;
      font-weight: bold;
      color: white;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }
    
    .distribution-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 8px 0;
      font-size: 9px;
    }
    
    .distribution-label {
      width: 60px;
      font-weight: 600;
    }
    
    .distribution-bar {
      flex: 1;
      height: 16px;
      background: #e9ecef;
      border-radius: 8px;
      position: relative;
      overflow: hidden;
    }
    
    .distribution-fill {
      height: 100%;
      background: #0066cc;
      opacity: 0.3;
    }
    
    .distribution-player-marker {
      position: absolute;
      top: 0;
      height: 100%;
      width: 3px;
      background: #dc3545;
    }
    
    .leader-badge {
      background: #ffd700;
      color: #000;
      padding: 2px 8px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 8px;
      display: inline-block;
      margin-left: 4px;
    }
  </style>
</head>
<body>

  <!-- PAGE 1: SUMMARY & OVERVIEW -->
  <div class="page">
    <h1>üèÄ {{ player_name }}</h1>
    
    <div class="header-info">
      <p><strong>Report Type:</strong> {{ game_type }}</p>
      <p><strong>Games Played:</strong> {{ games_played }}</p>
      <p><strong>Total Minutes:</strong> {{ "%.1f"|format(avg_stats.minutes * games_played) }}</p>
      <p><strong>Avg +/-:</strong> 
        {% if advanced.avg_plus_minus is not none %}
          <span class="{% if advanced.avg_plus_minus > 0 %}positive{% elif advanced.avg_plus_minus < 0 %}negative{% endif %}">{{ "%+.1f"|format(advanced.avg_plus_minus) }}</span>
        {% else %}
          <span style="color: #666;">N/A</span>
        {% endif %}
      </p>
      <p><strong>Generated:</strong> {{ generated_date }}</p>
    </div>

    <h2>Season Summary</h2>
    <div class="stat-grid">
      <div class="stat-card">
        <div class="stat-label">PPG</div>
        <div class="stat-value">{{ "%.1f"|format(avg_stats.points) }}</div>
        {% if team_rankings and team_rankings.ppg %}
        <div class="note">#{{ team_rankings.ppg.rank }} on team</div>
        {% endif %}
      </div>
      <div class="stat-card">
        <div class="stat-label">RPG</div>
        <div class="stat-value">{{ "%.1f"|format(avg_stats.reb) }}</div>
        {% if team_rankings and team_rankings.rpg %}
        <div class="note">#{{ team_rankings.rpg.rank }} on team</div>
        {% endif %}
      </div>
      <div class="stat-card">
        <div class="stat-label">APG</div>
        <div class="stat-value">{{ "%.1f"|format(avg_stats.apg) }}</div>
        {% if team_rankings and team_rankings.apg %}
        <div class="note">#{{ team_rankings.apg.rank }} on team</div>
        {% endif %}
      </div>
      <div class="stat-card">
        <div class="stat-label">+/-</div>
        {% if advanced.avg_plus_minus is not none %}
          <div class="stat-value" style="color: {% if advanced.avg_plus_minus > 0 %}#28a745{% elif advanced.avg_plus_minus < 0 %}#dc3545{% else %}#666{% endif %}">{{ "%+.1f"|format(advanced.avg_plus_minus) }}</div>
        {% else %}
          <div class="stat-value" style="color: #666;">N/A</div>
        {% endif %}
        <div class="note">Per Game</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">FG%</div>
        <div class="stat-value">{{ "%.1f"|format(shooting.fg.pct) }}%</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">3P%</div>
        <div class="stat-value">{{ "%.1f"|format(shooting.three_pt.pct) }}%</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">TS%</div>
        <div class="stat-value">{{ "%.1f"|format(advanced.ts_pct) }}%</div>
        {% if team_rankings and team_rankings.ts_pct %}
        <div class="note">#{{ team_rankings.ts_pct.rank }} on team</div>
        {% endif %}
      </div>
      <div class="stat-card">
        <div class="stat-label">MPG</div>
        <div class="stat-value">{{ "%.1f"|format(avg_stats.minutes) }}</div>
      </div>
    </div>

    <h2>Season Totals</h2>
    <table>
      <tr>
        <th>MIN</th><th>PTS</th><th>REB</th><th>AST</th><th>STL</th>
        <th>BLK</th><th>TOV</th><th>PF</th><th>+/-</th>
      </tr>
      <tr>
        <td>{{ "%.0f"|format(avg_stats.minutes * games_played) }}</td>
        <td class="highlight">{{ "%.0f"|format(avg_stats.points * games_played) }}</td>
        <td>{{ "%.0f"|format(avg_stats.reb * games_played) }}</td>
        <td>{{ "%.0f"|format(avg_stats.ast * games_played) }}</td>
        <td>{{ "%.0f"|format(avg_stats.stl * games_played) }}</td>
        <td>{{ "%.0f"|format(avg_stats.blk * games_played) }}</td>
        <td>{{ "%.0f"|format(avg_stats.tov * games_played) }}</td>
        <td>{{ "%.0f"|format(avg_stats.pf * games_played) }}</td>
        {% if advanced.avg_plus_minus is not none %}
          <td class="{% if advanced.avg_plus_minus * games_played > 0 %}positive{% elif advanced.avg_plus_minus * games_played < 0 %}negative{% endif %}">{{ "%+.0f"|format(advanced.avg_plus_minus * games_played) }}</td>
        {% else %}
          <td style="color: #666;">N/A</td>
        {% endif %}
      </tr>
    </table>

    <h3>Shooting Totals</h3>
    <table>
      <tr>
        <th>FGM-FGA</th><th>FG%</th><th>2PM-2PA</th><th>2P%</th>
        <th>3PM-3PA</th><th>3P%</th><th>FTM-FTA</th><th>FT%</th>
      </tr>
      <tr>
        <td>{{ "%.0f"|format(shooting.fg.made * games_played) }}-{{ "%.0f"|format(shooting.fg.att * games_played) }}</td>
        <td>{{ "%.1f"|format(shooting.fg.pct) }}%</td>
        <td>{{ "%.0f"|format(shooting.two_pt.made * games_played) }}-{{ "%.0f"|format(shooting.two_pt.att * games_played) }}</td>
        <td>{{ "%.1f"|format(shooting.two_pt.pct) }}%</td>
        <td>{{ "%.0f"|format(shooting.three_pt.made * games_played) }}-{{ "%.0f"|format(shooting.three_pt.att * games_played) }}</td>
        <td>{{ "%.1f"|format(shooting.three_pt.pct) }}%</td>
        <td>{{ "%.0f"|format(shooting.ft.made * games_played) }}-{{ "%.0f"|format(shooting.ft.att * games_played) }}</td>
        <td>{{ "%.1f"|format(shooting.ft.pct) }}%</td>
      </tr>
    </table>

    <h3>Rebounding Breakdown</h3>
    <table>
      <tr>
        <th>Total REB</th><th>OREB</th><th>DREB</th><th>OREB%</th><th>DREB%</th>
      </tr>
      <tr>
        <td>{{ "%.0f"|format(avg_stats.reb * games_played) }}</td>
        <td>{{ "%.0f"|format(avg_stats.oreb * games_played) }}</td>
        <td>{{ "%.0f"|format(avg_stats.dreb * games_played) }}</td>
        <td>{{ "%.1f"|format(advanced.oreb_pct if advanced.oreb_pct else 0) }}%</td>
        <td>{{ "%.1f"|format(advanced.dreb_pct if advanced.dreb_pct else 0) }}%</td>
      </tr>
    </table>
  </div>
  
  <div class="page-break"></div>

  <!-- PAGE 2: TEAM RANKINGS & PERCENTILES -->
  {% if team_rankings %}
  <div class="page">
    <h1>{{ player_name }} - Team Rankings</h1>

    <h2>Performance Rankings</h2>
    <div class="section-box">
      {% for metric_key, metric_name in [('ppg', 'Points Per Game'), ('rpg', 'Rebounds Per Game'), ('apg', 'Assists Per Game')] %}
        {% if team_rankings[metric_key] %}
        {% set ranking = team_rankings[metric_key] %}
        <div class="distribution-row">
          <div class="distribution-label">{{ metric_name }}:</div>
          <div style="flex: 1;">
            <strong>#{{ ranking.rank }} of {{ ranking.total }}</strong>
            {% if ranking.is_leader %}
              <span class="leader-badge">üèÜ TEAM LEADER</span>
            {% elif ranking.rank <= 3 %}
              <span class="rank-badge rank-top3">TOP 3</span>
            {% elif ranking.percentile >= 50 %}
              <span class="rank-badge rank-top50">TOP {{ ranking.percentile|int }}%</span>
            {% else %}
              <span class="rank-badge rank-bottom">{{ ranking.percentile|int }}th %ile</span>
            {% endif %}
            <div class="percentile-bar">
              <div class="percentile-fill" style="width: {{ ranking.percentile }}%;"></div>
              <div class="percentile-marker" style="left: {{ ranking.percentile }}%;">{{ ranking.percentile|int }}%</div>
            </div>
          </div>
        </div>
        {% endif %}
      {% endfor %}
    </div>

    <h2>Advanced Metrics Rankings</h2>
    <div class="section-box">
      {% for metric_key, metric_name in [('ts_pct', 'True Shooting %'), ('efg_pct', 'Effective FG %'), ('ortg', 'Offensive Rating'), ('ast_tov', 'AST/TOV Ratio')] %}
        {% if team_rankings[metric_key] %}
        {% set ranking = team_rankings[metric_key] %}
        <div class="distribution-row">
          <div class="distribution-label">{{ metric_name }}:</div>
          <div style="flex: 1;">
            <strong>#{{ ranking.rank }} of {{ ranking.total }}</strong>
            {% if ranking.is_leader %}
              <span class="leader-badge">üèÜ TEAM LEADER</span>
            {% elif ranking.rank <= 3 %}
              <span class="rank-badge rank-top3">TOP 3</span>
            {% elif ranking.percentile >= 50 %}
              <span class="rank-badge rank-top50">TOP {{ ranking.percentile|int }}%</span>
            {% else %}
              <span class="rank-badge rank-bottom">{{ ranking.percentile|int }}th %ile</span>
            {% endif %}
            <div class="percentile-bar">
              <div class="percentile-fill" style="width: {{ ranking.percentile }}%;"></div>
              <div class="percentile-marker" style="left: {{ ranking.percentile }}%;">{{ ranking.percentile|int }}%</div>
            </div>
          </div>
        </div>
        {% endif %}
      {% endfor %}
    </div>

    <h2>Team Distribution Analysis</h2>
    <div class="section-box">
      <p class="note" style="font-size: 9px; margin-bottom: 10px;">
        The charts below show where {{ player_name }} ranks within the team distribution for key metrics. 
        The red line indicates the player's position relative to teammates.
      </p>
      
      {% for metric_key, metric_name in [('ppg', 'PPG'), ('ts_pct', 'TS%'), ('ortg', 'ORTG')] %}
        {% if team_rankings[metric_key] and team_rankings[metric_key].distribution %}
        {% set ranking = team_rankings[metric_key] %}
        {% set min_val = ranking.distribution|min %}
        {% set max_val = ranking.distribution|max %}
        {% set range_val = max_val - min_val %}
        {% set player_val = ranking.player_value %}
        {% set player_pos = ((player_val - min_val) / range_val * 100) if range_val > 0 else 50 %}
        
        <div style="margin: 15px 0;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
            <strong style="font-size: 10px;">{{ metric_name }}</strong>
            <span style="font-size: 9px;">{{ "%.1f"|format(min_val) }} ‚Üí {{ "%.1f"|format(max_val) }}</span>
          </div>
          <div class="distribution-bar">
            <div class="distribution-fill" style="width: 100%;"></div>
            <div class="distribution-player-marker" style="left: {{ player_pos }}%;"></div>
          </div>
          <div style="text-align: center; font-size: 8px; margin-top: 2px; color: #dc3545;">
            ‚ñ≤ {{ player_name }}: {{ "%.1f"|format(player_val) }}
          </div>
        </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
  
  <div class="page-break"></div>
  {% endif %}

  <!-- PAGE 3: SHOOTING BREAKDOWN WITH SHOT CHART -->
  <div class="page">
    <h1>{{ player_name }} - Shooting Analysis</h1>

    <h2>Shooting Percentages</h2>
    <div class="stat-grid">
      <div class="stat-card">
        <div class="stat-label">Field Goal %</div>
        <div class="stat-value">{{ "%.1f"|format(shooting.fg.pct) }}%</div>
        <div class="note">{{ "%.0f"|format(shooting.fg.made * games_played) }}/{{ "%.0f"|format(shooting.fg.att * games_played) }}</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">2-Point %</div>
        <div class="stat-value">{{ "%.1f"|format(shooting.two_pt.pct) }}%</div>
        <div class="note">{{ "%.0f"|format(shooting.two_pt.made * games_played) }}/{{ "%.0f"|format(shooting.two_pt.att * games_played) }}</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">3-Point %</div>
        <div class="stat-value">{{ "%.1f"|format(shooting.three_pt.pct) }}%</div>
        <div class="note">{{ "%.0f"|format(shooting.three_pt.made * games_played) }}/{{ "%.0f"|format(shooting.three_pt.att * games_played) }}</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Free Throw %</div>
        <div class="stat-value">{{ "%.1f"|format(shooting.ft.pct) }}%</div>
        <div class="note">{{ "%.0f"|format(shooting.ft.made * games_played) }}/{{ "%.0f"|format(shooting.ft.att * games_played) }}</div>
      </div>
    </div>

    {% if shot_chart %}
    <h2>Shot Chart</h2>
    <div class="chart-container">
      <img src="data:image/png;base64,{{ shot_chart }}" alt="Shot Chart">
    </div>
    <p class="note">Shot locations show made shots (green circles) and missed shots (red X). Chart represents half-court shooting zones.</p>
    {% endif %}

    <h2>Advanced Shooting Metrics</h2>
    <table>
      <tr>
        <th>Metric</th><th>Player Value</th><th>Team Avg</th><th>Description</th>
      </tr>
      <tr>
        <td>True Shooting %</td>
        <td class="highlight">{{ "%.1f"|format(advanced.ts_pct) }}%</td>
        <td>{{ "%.1f"|format(team_avg.ts_pct) }}%</td>
        <td>Shooting efficiency accounting for FTs and 3PTs</td>
      </tr>
      <tr>
        <td>Effective FG %</td>
        <td class="highlight">{{ "%.1f"|format(advanced.efg_pct) }}%</td>
        <td>{{ "%.1f"|format(team_avg.efg_pct) }}%</td>
        <td>FG% adjusted for 3PT value</td>
      </tr>
    </table>

    <h2>Shot Distribution</h2>
    <table>
      <tr>
        <th>Shot Type</th><th>Makes</th><th>Attempts</th><th>%</th><th>Per Game</th>
      </tr>
      <tr>
        <td>2-Point</td>
        <td>{{ "%.0f"|format(shooting.two_pt.made * games_played) }}</td>
        <td>{{ "%.0f"|format(shooting.two_pt.att * games_played) }}</td>
        <td>{{ "%.1f"|format(shooting.two_pt.pct) }}%</td>
        <td>{{ "%.1f"|format(shooting.two_pt.att) }}</td>
      </tr>
      <tr>
        <td>3-Point</td>
        <td>{{ "%.0f"|format(shooting.three_pt.made * games_played) }}</td>
        <td>{{ "%.0f"|format(shooting.three_pt.att * games_played) }}</td>
        <td>{{ "%.1f"|format(shooting.three_pt.pct) }}%</td>
        <td>{{ "%.1f"|format(shooting.three_pt.att) }}</td>
      </tr>
      <tr>
        <td>Free Throw</td>
        <td>{{ "%.0f"|format(shooting.ft.made * games_played) }}</td>
        <td>{{ "%.0f"|format(shooting.ft.att * games_played) }}</td>
        <td>{{ "%.1f"|format(shooting.ft.pct) }}%</td>
        <td>{{ "%.1f"|format(shooting.ft.att) }}</td>
      </tr>
    </table>
  </div>
  
  <div class="page-break"></div>

  <!-- PAGE 4: ADVANCED METRICS -->
  <div class="page">
    <h1>{{ player_name }} - Advanced Metrics</h1>

    <h2>Offensive Metrics vs Team Average</h2>
    <div class="section-box">
      <table>
        <tr>
          <th>Metric</th><th>Player</th><th>Team Avg</th><th>Elite</th><th>Meaning</th>
        </tr>
        <tr>
          <td>Offensive Rating (ORTG)</td>
          <td class="highlight">{{ "%.1f"|format(advanced.ortg) }}</td>
          <td>{{ "%.1f"|format(team_avg.ortg) }}</td>
          <td>&gt;110</td>
          <td>Points per 100 possessions</td>
        </tr>
        <tr>
          <td>Plus/Minus (+/-)</td>
          {% if advanced.avg_plus_minus is not none %}
            <td class="highlight {% if advanced.avg_plus_minus > 0 %}positive{% elif advanced.avg_plus_minus < 0 %}negative{% endif %}">{{ "%+.1f"|format(advanced.avg_plus_minus) }}</td>
          {% else %}
            <td class="highlight" style="color: #666;">N/A</td>
          {% endif %}
          <td>-</td>
          <td>&gt;+5</td>
          <td>Point differential when on court</td>
        </tr>
        <tr>
          <td>Points Per Possession (PPP)</td>
          <td class="highlight">{{ "%.3f"|format(advanced.ppp if advanced.ppp else 0) }}</td>
          <td>-</td>
          <td>&gt;1.10</td>
          <td>Scoring efficiency per possession</td>
        </tr>
        <tr>
          <td>AST/TOV Ratio</td>
          <td class="highlight">{{ "%.2f"|format(advanced.ast_tov) }}</td>
          <td>{{ "%.2f"|format(team_avg.ast_tov) }}</td>
          <td>&gt;2.0</td>
          <td>Decision making quality</td>
        </tr>
      </table>
    </div>

    <h2>Performance Benchmarks</h2>
    <div class="section-box">
      <h3>Scoring Efficiency</h3>
      <p>
        {% if advanced.ts_pct >= 60 %}
          ‚úÖ <strong>Elite</strong> - TS% of {{ "%.1f"|format(advanced.ts_pct) }}% is outstanding (Team: {{ "%.1f"|format(team_avg.ts_pct) }}%)
        {% elif advanced.ts_pct >= 55 %}
          ‚úÖ <strong>Above Average</strong> - TS% of {{ "%.1f"|format(advanced.ts_pct) }}% is solid (Team: {{ "%.1f"|format(team_avg.ts_pct) }}%)
        {% elif advanced.ts_pct >= 50 %}
          ‚ö†Ô∏è <strong>Average</strong> - TS% of {{ "%.1f"|format(advanced.ts_pct) }}% is acceptable (Team: {{ "%.1f"|format(team_avg.ts_pct) }}%)
        {% else %}
          ‚ùå <strong>Below Average</strong> - TS% of {{ "%.1f"|format(advanced.ts_pct) }}% needs improvement (Team: {{ "%.1f"|format(team_avg.ts_pct) }}%)
        {% endif %}
        {% if team_rankings and team_rankings.ts_pct %}
          <span class="rank-badge rank-{% if team_rankings.ts_pct.percentile >= 66 %}top3{% elif team_rankings.ts_pct.percentile >= 33 %}top50{% else %}bottom{% endif %}">
            #{{ team_rankings.ts_pct.rank }} on team
          </span>
        {% endif %}
      </p>

      <h3>Playmaking</h3>
      <p>
        {% if advanced.ast_tov >= 2.0 %}
          ‚úÖ <strong>Excellent</strong> - AST/TOV of {{ "%.2f"|format(advanced.ast_tov) }} shows great decision making (Team: {{ "%.2f"|format(team_avg.ast_tov) }})
        {% elif advanced.ast_tov >= 1.5 %}
          ‚úÖ <strong>Good</strong> - AST/TOV of {{ "%.2f"|format(advanced.ast_tov) }} is solid (Team: {{ "%.2f"|format(team_avg.ast_tov) }})
        {% elif advanced.ast_tov >= 1.0 %}
          ‚ö†Ô∏è <strong>Average</strong> - AST/TOV of {{ "%.2f"|format(advanced.ast_tov) }} is adequate (Team: {{ "%.2f"|format(team_avg.ast_tov) }})
        {% else %}
          ‚ùå <strong>Needs Work</strong> - AST/TOV of {{ "%.2f"|format(advanced.ast_tov) }} indicates turnover issues (Team: {{ "%.2f"|format(team_avg.ast_tov) }})
        {% endif %}
        {% if team_rankings and team_rankings.ast_tov %}
          <span class="rank-badge rank-{% if team_rankings.ast_tov.percentile >= 66 %}top3{% elif team_rankings.ast_tov.percentile >= 33 %}top50{% else %}bottom{% endif %}">
            #{{ team_rankings.ast_tov.rank }} on team
          </span>
        {% endif %}
      </p>

      <h3>Impact Metrics</h3>
      <p>
        {% if advanced.avg_plus_minus is not none %}
          {% if advanced.avg_plus_minus >= 5 %}
            ‚úÖ <strong>Elite Impact</strong> - +/- of {{ "%+.1f"|format(advanced.avg_plus_minus) }} shows dominant on-court presence
          {% elif advanced.avg_plus_minus >= 2 %}
            ‚úÖ <strong>Positive Impact</strong> - +/- of {{ "%+.1f"|format(advanced.avg_plus_minus) }} is valuable
          {% elif advanced.avg_plus_minus >= -2 %}
            ‚ö†Ô∏è <strong>Neutral</strong> - +/- of {{ "%+.1f"|format(advanced.avg_plus_minus) }} indicates balanced performance
          {% else %}
            ‚ùå <strong>Needs Improvement</strong> - +/- of {{ "%+.1f"|format(advanced.avg_plus_minus) }} suggests areas to work on
          {% endif %}
        {% else %}
          <span style="color: #666;">‚ÑπÔ∏è <strong>Impact Metrics Unavailable</strong> - +/- data not available for this period</span>
        {% endif %}
      </p>
    </div>
  </div>
  
  <div class="page-break"></div>

  <!-- PAGE 5: PERFORMANCE CHARTS -->
  <div class="page">
    <h1>{{ player_name }} - Performance Trends</h1>

    <h2>Scoring & Plus/Minus Progression</h2>
    {% if chart_scoring %}
    <div class="chart-container">
      <img src="data:image/png;base64,{{ chart_scoring }}" alt="Core Stats Chart">
    </div>
    <p class="note">Blue bars show points per game. Green line shows +/- trend. Dashed line is 3-game moving average.</p>
    {% else %}
    <p>Chart data not available.</p>
    {% endif %}

    <h2>Key Observations</h2>
    <div class="section-box">
      <p><strong>Consistency:</strong> The 3-game moving average helps identify performance trends and consistency over the season.</p>
      <p><strong>+/- Correlation:</strong> Strong positive +/- indicates the team performs better when this player is on court.</p>
      <p><strong>Growth Trend:</strong> Rising moving averages indicate improving form.</p>
    </div>
  </div>
  
  <div class="page-break"></div>

  <!-- PAGE 6: GAME-BY-GAME LOG -->
  <div class="page">
    <h1>{{ player_name }} - Game-by-Game Log</h1>

    <table class="game-log-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Opponent</th>
          <th>W/L</th>
          <th>MIN</th>
          <th>PTS</th>
          <th>REB</th>
          <th>AST</th>
          <th>STL</th>
          <th>BLK</th>
          <th>TOV</th>
          <th>FG</th>
          <th>FG%</th>
          <th>3P</th>
          <th>3P%</th>
          <th>FT</th>
          <th>FT%</th>
          <th>+/-</th>
        </tr>
      </thead>
      <tbody>
        {% for game in game_logs %}
        <tr>
          <td>{{ game.date }}</td>
          <td>{{ game.opponent }}</td>
          <td class="{% if game.result == 'W' %}win{% else %}loss{% endif %}">{{ game.result }}</td>
          <td>{{ game.minutes }}</td>
          <td class="{% if game.pts >= 20 %}highlight{% endif %}">{{ game.pts }}</td>
          <td>{{ game.reb }}</td>
          <td>{{ game.ast }}</td>
          <td>{{ game.stl }}</td>
          <td>{{ game.blk }}</td>
          <td>{{ game.tov }}</td>
          <td>{{ game.fgm }}/{{ game.fga }}</td>
          <td>{{ game.fg_pct }}%</td>
          <td>{{ game.tpm }}/{{ game.tpa }}</td>
          <td>{{ game.tp_percent }}%</td>
          <td>{{ game.ftm }}/{{ game.fta }}</td>
          <td>{{ game.ft_percent }}%</td>
          {% if game.plus_minus is not none %}
            <td class="{% if game.plus_minus > 0 %}positive{% elif game.plus_minus < 0 %}negative{% endif %}">{{ "%+d"|format(game.plus_minus) }}</td>
          {% else %}
            <td style="color: #666;">N/A</td>
          {% endif %}
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <p class="note" style="margin-top: 10px;">
      * Games with 20+ points are highlighted. +/- shows point differential when player was on court.
    </p>
  </div>

</body>
</html>